% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ks_hotspots.R
\name{run_ks_hot_vs_non}
\alias{run_ks_hot_vs_non}
\title{KS: hotspots vs non-hotspots per service × variable (with direction + summaries)}
\usage{
run_ks_hot_vs_non(
  hotspots_df,
  inverse_df,
  vars = NULL,
  include_services = NULL,
  exclude_services = NULL,
  adjust_method = "BH",
  permute_n = 0,
  seed = 42,
  sampling = c("none", "match_hot", "cap_nonhot"),
  nonhot_cap = 100000L,
  min_n = 2L,
  compute_one_sided = TRUE,
  add_summaries = TRUE,
  out_csv = "output_charts/ks_results_hot_vs_non.csv"
)
}
\arguments{
\item{hotspots_df}{Long-format table for hotspots (must include \code{service} and tested \code{vars}).}

\item{inverse_df}{Long-format table for non-hotspots (same \code{vars} present).}

\item{vars}{Character vector of variable names to test. If \code{NULL}, auto-detects
numeric columns common to both inputs, excluding typical meta cols.}

\item{include_services}{Optional character vector to keep only these services.}

\item{exclude_services}{Optional character vector of services to drop.}

\item{adjust_method}{Multiple-testing correction for p-values (default \code{"BH"}).}

\item{permute_n}{Integer. If \verb{>0}, compute permutation p by shuffling group labels
within service \code{permute_n} times and recomputing KS D.}

\item{seed}{Random seed (sampling/permutations).}

\item{sampling}{Strategy to control non-hotspot size per service:
\code{"none"} (use all), \code{"match_hot"} (sample nonhot to hotspot N),
\code{"cap_nonhot"} (cap nonhot at \code{nonhot_cap}).}

\item{nonhot_cap}{Integer cap when \code{sampling="cap_nonhot"}.}

\item{min_n}{Minimum per-group n to run tests (default 2).}

\item{compute_one_sided}{If TRUE, also add one-sided KS p-values (greater/less) + BH-adjusted.}

\item{add_summaries}{If TRUE, compute group summaries (means/medians/10th/90th) + deltas.}

\item{out_csv}{Optional path to write results CSV. If \code{NULL}, skip writing.}
}
\value{
Tibble with one row per \verb{service × var}:
\itemize{
\item \code{service}, \code{var}
\item \code{D}, \code{p_value}, \code{p_perm} (if requested), \code{p_adj}
\item \code{n_hot}, \code{n_non}
\item \code{auc}, \code{cliffs_delta}
\item (if summaries) \code{mean_*}, \code{median_*}, \code{q10_*}, \code{q90_*}, \code{*_delta}
\item (if one-sided) \code{p_hot_greater}, \code{p_hot_less}, \code{p_hot_greater_adj}, \code{p_hot_less_adj}
}
}
\description{
For each \verb{service × var}, compare hotspot vs non-hotspot distributions using
the two-sample Kolmogorov–Smirnov test. Returns a clean table with:
KS D, p-values (two-sided and optional one-sided, plus optional permuted p),
FDR-adjusted p (BH), directional effect sizes (AUC, Cliff's δ),
and group summaries (means/medians/quantiles, with deltas).
}
\section{Notes}{

\itemize{
\item KS detects \strong{any} distributional difference (location/scale/shape). AUC (≡ MW-U / probability of superiority)
and Cliff’s δ add \strong{direction} and interpretable effect size (−1..+1).
\item With very large, tied data, KS asymptotic p-values are approximate; permutation p helps.
\item Hotspots are \strong{tail-selected} on \verb{\% change}; interpret results as associations, not causality.
}
}

\examples{
\dontrun{
ks_res <- run_ks_hot_vs_non(
  hotspots_df = res$hotspots_df,
  inverse_df  = res$non_hotspots_df,
  vars = c("rast_gdpTot_1990_2020_30arcsec_2020_sum",
           "GHS_POP_E2020_GLOBE_sum",
           "GlobPOP_Count_30arc_2020_sum"),
  sampling = "match_hot",   # helpful when nonhot >> hot
  permute_n = 0,            # set to e.g. 500 for perm p
  compute_one_sided = TRUE,
  out_csv = "output_charts/ks_results_hot_vs_non.csv"
)
}

}
