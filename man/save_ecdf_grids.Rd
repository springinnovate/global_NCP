% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/save_ECDF.R
\name{save_ecdf_grids}
\alias{save_ecdf_grids}
\title{Save ECDF overlay grids (hotspots vs non-hotspots) for multiple variables}
\usage{
save_ecdf_grids(
  hotspots_df,
  inverse_df,
  vars,
  ks_res = NULL,
  service_selection = c("top_k", "all", "custom"),
  services_custom = NULL,
  top_k = 6,
  transform_default = c("auto", "identity", "log1p")[1],
  transform_by_var = NULL,
  line_size = 0.9,
  out_dir = "output_charts/ecdf",
  prefix = "ecdf",
  width = 10,
  height = 7,
  dpi = 300,
  use_ragg = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{hotspots_df}{Data frame of hotspot rows. Must contain a \code{service}
column and the variables listed in \code{vars}.}

\item{inverse_df}{Data frame of non-hotspot rows (complement), with the same
\code{service} column and variable columns as \code{hotspots_df}.}

\item{vars}{Character vector of variable (column) names to plot (e.g., GDP, POP).}

\item{ks_res}{Optional data frame with at least columns \code{var}, \code{service},
and \code{D} (KS statistic). When supplied, the function uses these D values
to choose the top-K services per variable for faceting. If \code{NULL}, a
quick KS-\eqn{D} is computed on the fly from the provided data.}

\item{service_selection}{One of \code{"top_k"}, \code{"all"}, or \code{"custom"}.
Controls which services appear as facets for each variable.}

\item{services_custom}{Character vector of services to facet when
\code{service_selection = "custom"}.}

\item{top_k}{Integer; number of services to facet when
\code{service_selection = "top_k"} (default).}

\item{transform_default}{One of \code{"auto"}, \code{"identity"}, \code{"log1p"}.
If \code{"auto"}, the function applies a light heuristic (e.g., non-negative,
heavy-tailed totals like GDP/POP get \code{"log1p"}). This transform is
\emph{visual-only} for the ECDF x-axis.}

\item{transform_by_var}{Optional named character vector mapping variable names
to transforms, e.g. \code{c(gdp = "log1p")}. These overrides take precedence
over \code{transform_default}.}

\item{line_size}{Numeric line width for the ECDF curves.}

\item{out_dir}{Output directory for PNG files. Created if missing.}

\item{prefix}{Filename prefix (e.g., \code{"ecdf"}). Each file is named as
\code{<prefix>_<variable>[_log1p].png}.}

\item{width, height, dpi}{Numeric PNG size/resolution passed to \code{ggsave()}.}

\item{use_ragg}{Logical; if \code{TRUE} and \pkg{ragg} is installed, use
\code{ragg::agg_png} for reliable raster output; otherwise falls back to base PNG.}

\item{verbose}{Logical; if \code{TRUE}, prints the saved file paths.}
}
\value{
Invisibly returns a character vector with the paths of the saved PNG files.
}
\description{
Batch-render and export ECDF overlay plots for a set of variables, faceted by
ecosystem service. Each plot shows the empirical CDFs of a chosen variable for
hotspot and non-hotspot groups. Services to facet can be selected as the top-K
by KS-\eqn{D} per variable (re-using a precomputed KS results table), all services,
or a custom list. X-axis transforms (\code{"identity"} or \code{"log1p"}) can be
set per variable or chosen automatically for skewed, non-negative variables.
}
\details{
The selection of services per variable works as follows:
\itemize{
\item If \code{service_selection = "top_k"} and \code{ks_res} is provided,
services are ordered by \code{D} within each \code{var} and the first
\code{top_k} are used.
\item If \code{service_selection = "top_k"} and \code{ks_res} is \code{NULL},
a quick KS-\eqn{D} is computed from the supplied data to pick the top-K.
\item If \code{service_selection = "all"}, all services present in either input
are faceted.
\item If \code{service_selection = "custom"}, \code{services_custom} is used.
}

The x-axis transform does not affect your KS results; it only improves ECDF
readability for skewed variables. Use \code{transform_by_var} for explicit control.
}
\examples{
\dontrun{
vars_to_test <- c(
  "rast_gdpTot_1990_2020_30arcsec_2020_sum",
  "GHS_POP_E2020_GLOBE_sum",
  "GlobPOP_Count_30arc_2020_sum"
)

# (A) Use precomputed KS results to select top-6 services per variable
save_ecdf_grids(
  hotspots_df, inverse_df,
  vars = vars_to_test,
  ks_res = ks_res,
  service_selection = "top_k",
  top_k = 6,
  transform_default = "auto",
  transform_by_var = c(
    "rast_gdpTot_1990_2020_30arcsec_2020_sum" = "log1p",
    "GHS_POP_E2020_GLOBE_sum"                 = "log1p"
  ),
  out_dir = "output_charts/ecdf",
  prefix = "ecdf"
)

# (B) Show all services for each variable, force log1p for everything
save_ecdf_grids(
  hotspots_df, inverse_df,
  vars = vars_to_test,
  service_selection = "all",
  transform_default = "log1p",
  out_dir = "output_charts/ecdf_all",
  prefix = "ecdf_all"
)
}

}
